{"ast":null,"code":"import React,{useEffect,useState}from'react';import axios from'axios';import{useParams}from'react-router-dom';import Loader from'../component/Loader';import Error from'../component/Error';import moment from'moment';import'antd/dist/reset.css';import Vehicle from'../component/Vehicle';import StripeCheckout from'react-stripe-checkout';import Swal from'sweetalert2';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Bookinsscreen(){const{fromdate,todate,vid}=useParams();const[loading,setLoading]=useState(false);const[error,setError]=useState(false);const[vehicle,setVehicle]=useState();const[totaldays,setTotalDays]=useState(0);const[totalamount,setTotalAmount]=useState(0);useEffect(()=>{if(!localStorage.getItem('currentUser')){window.location.href='/login';}const fetchData=async()=>{setLoading(true);try{const response=await axios.post(\"/api/gettvehiclesbyeid\",{vid});setVehicle(response.data);setLoading(false);}catch(error){setLoading(false);setError(true);}};fetchData();},[vid]);useEffect(()=>{if(fromdate&&todate){const fromDateFormatted=moment(fromdate,'DD-MM-YYYY',true);const toDateFormatted=moment(todate,'DD-MM-YYYY',true);if(fromDateFormatted.isValid()&&toDateFormatted.isValid()){const days=toDateFormatted.diff(fromDateFormatted,'days');setTotalDays(days);setTotalAmount(days*(vehicle?vehicle.rentperday:0));}else{setError(true);// Invalid date format\n}}},[fromdate,todate,vehicle]);async function bookVehicle(){const bookingDetails={vehicle,userid:JSON.parse(localStorage.getItem('currentUser'))._id,fromdate,todate,totalamount,totaldays};try{const result=await axios.post(\"/api/bookings/book\",bookingDetails);console.log(\"Booking successful:\",result.data);// Perform further actions upon successful booking\n}catch(error){console.error(\"Booking failed:\",error.message);// Handle booking error\n}}async function onToken(token){console.log(token);const bookingDetails={vehicle,userid:JSON.parse(localStorage.getItem('currentUser'))._id,fromdate,todate,totalamount,totaldays,token};try{setLoading(true);const result=await axios.post(\"/api/bookings/book\",bookingDetails);setLoading(false);console.log(\"Booking successful:\",result.data);Swal.fire('Congratulations',' your vehicle booked sucessfully','success').then(result=>{window.location.href='/profile';});// Perform further actions upon successful booking\n}catch(error){setLoading(false);Swal.fire('congratulations','something went wrong','error');console.error(\"Booking failed:\",error.message);// Handle booking error\n}}return/*#__PURE__*/_jsx(\"div\",{className:\"m-5\",children:loading?/*#__PURE__*/_jsx(Loader,{}):error||!vehicle?/*#__PURE__*/_jsx(Error,{}):/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"row justify-content-center mt-5 bs\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6\",children:[/*#__PURE__*/_jsx(\"h1\",{children:vehicle.name}),/*#__PURE__*/_jsx(\"img\",{src:vehicle.imageurls[0],className:\"bigimg\",alt:\"Vehicle\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:\"right\"},children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Booking Details\"}),/*#__PURE__*/_jsxs(\"b\",{children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Name:\",JSON.parse(localStorage.getItem('currentUser')).name,\" \"]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"From Date: \",fromdate]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"To Date: \",todate]})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{textAlign:\"right\"},children:/*#__PURE__*/_jsxs(\"b\",{children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Amount\"}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Total days: \",totaldays]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Rent Per day: \",vehicle.rentperday]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Total Amount: \",totalamount]})]})}),/*#__PURE__*/_jsx(\"div\",{style:{float:\"right\"},children:/*#__PURE__*/_jsx(StripeCheckout,{amount:totalamount*100,token:onToken,currency:\"NPR\",stripeKey:\"pk_test_51NkUTJA4TauPDoK9twCZokcjkvwSmjoGcH0x9ZknUzTqmQYkKGWQOCzztKXJ9X2odEBADVdYOgdpdxkcFCKxT6rk00xi5nRVUx\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary -m-2 \",children:\"Pay Now\"})})})]})]})})});}export default Bookinsscreen;","map":{"version":3,"names":["React","useEffect","useState","axios","useParams","Loader","Error","moment","Vehicle","StripeCheckout","Swal","jsx","_jsx","jsxs","_jsxs","Bookinsscreen","fromdate","todate","vid","loading","setLoading","error","setError","vehicle","setVehicle","totaldays","setTotalDays","totalamount","setTotalAmount","localStorage","getItem","window","location","href","fetchData","response","post","data","fromDateFormatted","toDateFormatted","isValid","days","diff","rentperday","bookVehicle","bookingDetails","userid","JSON","parse","_id","result","console","log","message","onToken","token","fire","then","className","children","name","src","imageurls","alt","style","textAlign","float","amount","currency","stripeKey"],"sources":["/Users/suvashneupane/frontendd/my-react-app/src/display/Bookinsscreen.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport axios from 'axios';\nimport { useParams } from 'react-router-dom';\nimport Loader from '../component/Loader';\nimport Error from '../component/Error';\nimport moment from 'moment';\nimport 'antd/dist/reset.css';\nimport Vehicle from '../component/Vehicle';\nimport StripeCheckout from 'react-stripe-checkout';\nimport Swal from 'sweetalert2'\nfunction Bookinsscreen() {\n  const { fromdate, todate, vid } = useParams();\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(false);\n  const [vehicle, setVehicle] = useState();\n  const [totaldays, setTotalDays] = useState(0);\n  const [totalamount, setTotalAmount] = useState(0);\n\n  useEffect(() => {\n    if (!localStorage.getItem('currentUser')) {\n      window.location.href = '/login';\n    }\n\n    const fetchData = async () => {\n      setLoading(true);\n      try {\n        const response = await axios.post(\"/api/gettvehiclesbyeid\", { vid });\n        setVehicle(response.data);\n        setLoading(false);\n      } catch (error) {\n        setLoading(false);\n        setError(true);\n      }\n    };\n\n    fetchData();\n  }, [vid]);\n\n  useEffect(() => {\n    if (fromdate && todate) {\n      const fromDateFormatted = moment(fromdate, 'DD-MM-YYYY', true);\n      const toDateFormatted = moment(todate, 'DD-MM-YYYY', true);\n\n      if (fromDateFormatted.isValid() && toDateFormatted.isValid()) {\n        const days = toDateFormatted.diff(fromDateFormatted, 'days');\n        setTotalDays(days);\n        setTotalAmount(days * (vehicle ? vehicle.rentperday : 0));\n      } else {\n        setError(true); // Invalid date format\n      }\n    }\n  }, [fromdate, todate, vehicle]);\n\n  async function bookVehicle() {\n    const bookingDetails = {\n      vehicle,\n      userid: JSON.parse(localStorage.getItem('currentUser'))._id,\n      fromdate,\n      todate,\n      totalamount,\n      totaldays,\n    };\n\n    try {\n      const result = await axios.post(\"/api/bookings/book\", bookingDetails);\n      console.log(\"Booking successful:\", result.data);\n      // Perform further actions upon successful booking\n    } catch (error) {\n      console.error(\"Booking failed:\", error.message);\n      // Handle booking error\n    }\n  }\n\n  async function onToken(token) {\n    console.log(token)\n    const bookingDetails = {\n      vehicle,\n      userid: JSON.parse(localStorage.getItem('currentUser'))._id,\n      fromdate,\n      todate,\n      totalamount,\n      totaldays,\n      token\n    };\n\n\n\n\n    try {\n      setLoading(true);\n      const result = await axios.post(\"/api/bookings/book\", bookingDetails);\n      setLoading(false)\n      console.log(\"Booking successful:\", result.data);\n      Swal.fire('Congratulations', ' your vehicle booked sucessfully', 'success').then(result => {\n        window.location.href = '/profile'\n      })\n      // Perform further actions upon successful booking\n    } catch (error) {\n      setLoading(false)\n      Swal.fire('congratulations', 'something went wrong', 'error')\n      console.error(\"Booking failed:\", error.message);\n      // Handle booking error\n    }\n\n\n\n\n\n\n\n\n\n\n  }\n\n\n\n\n  return (\n    <div className='m-5'>\n      {loading ? (\n        <Loader />\n      ) : error || !vehicle ? (\n        <Error />\n      ) : (\n        <div>\n          <div className='row justify-content-center mt-5 bs'>\n            <div className='col-md-6'>\n              <h1>{vehicle.name}</h1>\n              <img src={vehicle.imageurls[0]} className=\"bigimg\" alt=\"Vehicle\" />\n            </div>\n            <div className='col-md-6'>\n              <div style={{ textAlign: \"right\" }}>\n                <h1>Booking Details</h1>\n                <b>\n                  <p>Name:{JSON.parse(localStorage.getItem('currentUser')).name} </p>\n                  <p>From Date: {fromdate}</p>\n                  <p>To Date: {todate}</p>\n                </b>\n              </div>\n              <div style={{ textAlign: \"right\" }}>\n                <b>\n                  <h1>Amount</h1>\n                  <hr />\n                  <p>Total days: {totaldays}</p>\n                  <p>Rent Per day: {vehicle.rentperday}</p>\n                  <p>Total Amount: {totalamount}</p>\n                </b>\n              </div>\n              <div style={{ float: \"right\" }}>\n\n\n                <StripeCheckout\n                  amount={totalamount * 100}\n                  token={onToken}\n                  currency='NPR'\n                  stripeKey=\"pk_test_51NkUTJA4TauPDoK9twCZokcjkvwSmjoGcH0x9ZknUzTqmQYkKGWQOCzztKXJ9X2odEBADVdYOgdpdxkcFCKxT6rk00xi5nRVUx\"\n                >\n\n                  <button className='btn btn-primary -m-2 ' >Pay Now</button>\n\n\n\n\n                </StripeCheckout>\n\n\n\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default Bookinsscreen;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAClD,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,OAASC,SAAS,KAAQ,kBAAkB,CAC5C,MAAO,CAAAC,MAAM,KAAM,qBAAqB,CACxC,MAAO,CAAAC,KAAK,KAAM,oBAAoB,CACtC,MAAO,CAAAC,MAAM,KAAM,QAAQ,CAC3B,MAAO,qBAAqB,CAC5B,MAAO,CAAAC,OAAO,KAAM,sBAAsB,CAC1C,MAAO,CAAAC,cAAc,KAAM,uBAAuB,CAClD,MAAO,CAAAC,IAAI,KAAM,aAAa,QAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAC9B,QAAS,CAAAC,aAAaA,CAAA,CAAG,CACvB,KAAM,CAAEC,QAAQ,CAAEC,MAAM,CAAEC,GAAI,CAAC,CAAGd,SAAS,CAAC,CAAC,CAC7C,KAAM,CAACe,OAAO,CAAEC,UAAU,CAAC,CAAGlB,QAAQ,CAAC,KAAK,CAAC,CAC7C,KAAM,CAACmB,KAAK,CAAEC,QAAQ,CAAC,CAAGpB,QAAQ,CAAC,KAAK,CAAC,CACzC,KAAM,CAACqB,OAAO,CAAEC,UAAU,CAAC,CAAGtB,QAAQ,CAAC,CAAC,CACxC,KAAM,CAACuB,SAAS,CAAEC,YAAY,CAAC,CAAGxB,QAAQ,CAAC,CAAC,CAAC,CAC7C,KAAM,CAACyB,WAAW,CAAEC,cAAc,CAAC,CAAG1B,QAAQ,CAAC,CAAC,CAAC,CAEjDD,SAAS,CAAC,IAAM,CACd,GAAI,CAAC4B,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC,CAAE,CACxCC,MAAM,CAACC,QAAQ,CAACC,IAAI,CAAG,QAAQ,CACjC,CAEA,KAAM,CAAAC,SAAS,CAAG,KAAAA,CAAA,GAAY,CAC5Bd,UAAU,CAAC,IAAI,CAAC,CAChB,GAAI,CACF,KAAM,CAAAe,QAAQ,CAAG,KAAM,CAAAhC,KAAK,CAACiC,IAAI,CAAC,wBAAwB,CAAE,CAAElB,GAAI,CAAC,CAAC,CACpEM,UAAU,CAACW,QAAQ,CAACE,IAAI,CAAC,CACzBjB,UAAU,CAAC,KAAK,CAAC,CACnB,CAAE,MAAOC,KAAK,CAAE,CACdD,UAAU,CAAC,KAAK,CAAC,CACjBE,QAAQ,CAAC,IAAI,CAAC,CAChB,CACF,CAAC,CAEDY,SAAS,CAAC,CAAC,CACb,CAAC,CAAE,CAAChB,GAAG,CAAC,CAAC,CAETjB,SAAS,CAAC,IAAM,CACd,GAAIe,QAAQ,EAAIC,MAAM,CAAE,CACtB,KAAM,CAAAqB,iBAAiB,CAAG/B,MAAM,CAACS,QAAQ,CAAE,YAAY,CAAE,IAAI,CAAC,CAC9D,KAAM,CAAAuB,eAAe,CAAGhC,MAAM,CAACU,MAAM,CAAE,YAAY,CAAE,IAAI,CAAC,CAE1D,GAAIqB,iBAAiB,CAACE,OAAO,CAAC,CAAC,EAAID,eAAe,CAACC,OAAO,CAAC,CAAC,CAAE,CAC5D,KAAM,CAAAC,IAAI,CAAGF,eAAe,CAACG,IAAI,CAACJ,iBAAiB,CAAE,MAAM,CAAC,CAC5DZ,YAAY,CAACe,IAAI,CAAC,CAClBb,cAAc,CAACa,IAAI,EAAIlB,OAAO,CAAGA,OAAO,CAACoB,UAAU,CAAG,CAAC,CAAC,CAAC,CAC3D,CAAC,IAAM,CACLrB,QAAQ,CAAC,IAAI,CAAC,CAAE;AAClB,CACF,CACF,CAAC,CAAE,CAACN,QAAQ,CAAEC,MAAM,CAAEM,OAAO,CAAC,CAAC,CAE/B,cAAe,CAAAqB,WAAWA,CAAA,CAAG,CAC3B,KAAM,CAAAC,cAAc,CAAG,CACrBtB,OAAO,CACPuB,MAAM,CAAEC,IAAI,CAACC,KAAK,CAACnB,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC,CAAC,CAACmB,GAAG,CAC3DjC,QAAQ,CACRC,MAAM,CACNU,WAAW,CACXF,SACF,CAAC,CAED,GAAI,CACF,KAAM,CAAAyB,MAAM,CAAG,KAAM,CAAA/C,KAAK,CAACiC,IAAI,CAAC,oBAAoB,CAAES,cAAc,CAAC,CACrEM,OAAO,CAACC,GAAG,CAAC,qBAAqB,CAAEF,MAAM,CAACb,IAAI,CAAC,CAC/C;AACF,CAAE,MAAOhB,KAAK,CAAE,CACd8B,OAAO,CAAC9B,KAAK,CAAC,iBAAiB,CAAEA,KAAK,CAACgC,OAAO,CAAC,CAC/C;AACF,CACF,CAEA,cAAe,CAAAC,OAAOA,CAACC,KAAK,CAAE,CAC5BJ,OAAO,CAACC,GAAG,CAACG,KAAK,CAAC,CAClB,KAAM,CAAAV,cAAc,CAAG,CACrBtB,OAAO,CACPuB,MAAM,CAAEC,IAAI,CAACC,KAAK,CAACnB,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC,CAAC,CAACmB,GAAG,CAC3DjC,QAAQ,CACRC,MAAM,CACNU,WAAW,CACXF,SAAS,CACT8B,KACF,CAAC,CAKD,GAAI,CACFnC,UAAU,CAAC,IAAI,CAAC,CAChB,KAAM,CAAA8B,MAAM,CAAG,KAAM,CAAA/C,KAAK,CAACiC,IAAI,CAAC,oBAAoB,CAAES,cAAc,CAAC,CACrEzB,UAAU,CAAC,KAAK,CAAC,CACjB+B,OAAO,CAACC,GAAG,CAAC,qBAAqB,CAAEF,MAAM,CAACb,IAAI,CAAC,CAC/C3B,IAAI,CAAC8C,IAAI,CAAC,iBAAiB,CAAE,kCAAkC,CAAE,SAAS,CAAC,CAACC,IAAI,CAACP,MAAM,EAAI,CACzFnB,MAAM,CAACC,QAAQ,CAACC,IAAI,CAAG,UAAU,CACnC,CAAC,CAAC,CACF;AACF,CAAE,MAAOZ,KAAK,CAAE,CACdD,UAAU,CAAC,KAAK,CAAC,CACjBV,IAAI,CAAC8C,IAAI,CAAC,iBAAiB,CAAE,sBAAsB,CAAE,OAAO,CAAC,CAC7DL,OAAO,CAAC9B,KAAK,CAAC,iBAAiB,CAAEA,KAAK,CAACgC,OAAO,CAAC,CAC/C;AACF,CAWF,CAKA,mBACEzC,IAAA,QAAK8C,SAAS,CAAC,KAAK,CAAAC,QAAA,CACjBxC,OAAO,cACNP,IAAA,CAACP,MAAM,GAAE,CAAC,CACRgB,KAAK,EAAI,CAACE,OAAO,cACnBX,IAAA,CAACN,KAAK,GAAE,CAAC,cAETM,IAAA,QAAA+C,QAAA,cACE7C,KAAA,QAAK4C,SAAS,CAAC,oCAAoC,CAAAC,QAAA,eACjD7C,KAAA,QAAK4C,SAAS,CAAC,UAAU,CAAAC,QAAA,eACvB/C,IAAA,OAAA+C,QAAA,CAAKpC,OAAO,CAACqC,IAAI,CAAK,CAAC,cACvBhD,IAAA,QAAKiD,GAAG,CAAEtC,OAAO,CAACuC,SAAS,CAAC,CAAC,CAAE,CAACJ,SAAS,CAAC,QAAQ,CAACK,GAAG,CAAC,SAAS,CAAE,CAAC,EAChE,CAAC,cACNjD,KAAA,QAAK4C,SAAS,CAAC,UAAU,CAAAC,QAAA,eACvB7C,KAAA,QAAKkD,KAAK,CAAE,CAAEC,SAAS,CAAE,OAAQ,CAAE,CAAAN,QAAA,eACjC/C,IAAA,OAAA+C,QAAA,CAAI,iBAAe,CAAI,CAAC,cACxB7C,KAAA,MAAA6C,QAAA,eACE7C,KAAA,MAAA6C,QAAA,EAAG,OAAK,CAACZ,IAAI,CAACC,KAAK,CAACnB,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC,CAAC,CAAC8B,IAAI,CAAC,GAAC,EAAG,CAAC,cACnE9C,KAAA,MAAA6C,QAAA,EAAG,aAAW,CAAC3C,QAAQ,EAAI,CAAC,cAC5BF,KAAA,MAAA6C,QAAA,EAAG,WAAS,CAAC1C,MAAM,EAAI,CAAC,EACvB,CAAC,EACD,CAAC,cACNL,IAAA,QAAKoD,KAAK,CAAE,CAAEC,SAAS,CAAE,OAAQ,CAAE,CAAAN,QAAA,cACjC7C,KAAA,MAAA6C,QAAA,eACE/C,IAAA,OAAA+C,QAAA,CAAI,QAAM,CAAI,CAAC,cACf/C,IAAA,QAAK,CAAC,cACNE,KAAA,MAAA6C,QAAA,EAAG,cAAY,CAAClC,SAAS,EAAI,CAAC,cAC9BX,KAAA,MAAA6C,QAAA,EAAG,gBAAc,CAACpC,OAAO,CAACoB,UAAU,EAAI,CAAC,cACzC7B,KAAA,MAAA6C,QAAA,EAAG,gBAAc,CAAChC,WAAW,EAAI,CAAC,EACjC,CAAC,CACD,CAAC,cACNf,IAAA,QAAKoD,KAAK,CAAE,CAAEE,KAAK,CAAE,OAAQ,CAAE,CAAAP,QAAA,cAG7B/C,IAAA,CAACH,cAAc,EACb0D,MAAM,CAAExC,WAAW,CAAG,GAAI,CAC1B4B,KAAK,CAAED,OAAQ,CACfc,QAAQ,CAAC,KAAK,CACdC,SAAS,CAAC,6GAA6G,CAAAV,QAAA,cAGvH/C,IAAA,WAAQ8C,SAAS,CAAC,uBAAuB,CAAAC,QAAA,CAAE,SAAO,CAAQ,CAAC,CAK7C,CAAC,CAId,CAAC,EACH,CAAC,EACH,CAAC,CACH,CACN,CACE,CAAC,CAEV,CAEA,cAAe,CAAA5C,aAAa"},"metadata":{},"sourceType":"module","externalDependencies":[]}